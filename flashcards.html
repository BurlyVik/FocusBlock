<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quizlet-Style Flashcards</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f6f7fb;
    color: #222;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
  }
  h1 {
    font-size: 1.6rem;
    margin-bottom: 1.2rem;
    font-weight: 600;
    color: #333;
  }
  #qCount {
    margin-bottom: 1.2rem;
    font-size: 1rem;
    font-weight: 500;
    color: #666;
  }

  /* Card + options container */
  .flashcard-container {
    display: flex;
    align-items: stretch;
    justify-content: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    width: 100%;
    max-width: 960px;
    flex-wrap: wrap;
  }
  .flashcard {
    flex: 1 1 50%;
    max-width: 500px;
    min-height: 320px;
    perspective: 1200px;
  }
  .card {
    width: 100%;
    height: 320px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    cursor: pointer;
    background: #fff;
  }
  .card.flipped { transform: rotateY(180deg); }

  .side {
    position: absolute;
    inset: 0;
    padding: 1.5rem;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: 1.05rem;
    font-weight: 500;
    line-height: 1.5;
    backface-visibility: hidden; /* ðŸ”‘ */
    overflow-y: auto;
    word-wrap: break-word;
  }
  .front {
    transform: rotateY(0deg);
    background: #fff;
    backface-visibility: hidden;
  }
  .back {
    transform: rotateY(180deg);
    background: #fafafa;
    backface-visibility: hidden;
  }

  /* Options to the right */
  .options {
    flex: 1 1 40%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.75rem;
  }
  .option {
    padding: 0.9rem 1rem;
    border: 1px solid #d0d0d0;
    border-radius: 10px;
    background: #fff;
    font-size: 1rem;
    line-height: 1.4;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s ease;
    word-break: break-word;
    white-space: normal;
  }
  .option:hover {
    border-color: #999;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  .option.selected { border: 2px solid #555; background: #eef0ff; }
  .option.correct { border: 2px solid #2e7d32; background: #c8e6c9; }
  .option.wrong { border: 2px solid #c62828; background: #ffcdd2; }

  /* Controls */
  .controls-row {
    margin-top: 1.2rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    justify-content: center;
  }
  button {
    padding: 0.55rem 1.1rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 500;
    background: #1976d2;
    color: #fff;
    transition: background 0.2s ease;
  }
  button:hover { background: #1259a9; }
  .bookmark-btn {
    font-size: 1.3rem;
    background: transparent;
    color: #666;
    padding: 0.3rem 0.6rem;
  }
  .bookmark-btn.bookmarked { color: #f4b400; }
  #showBookmarkedBtn.show-bookmarked {
    background: #ffc107;
    color: #333;
  }

  #feedback {
    margin-top: 0.8rem;
    min-height: 24px;
    font-size: 1.05rem;
    font-weight: 500;
  }

  @media (max-width: 800px) {
    .flashcard-container {
      flex-direction: column;
    }
    .flashcard, .options {
      flex: 1 1 100%;
      max-width: 100%;
    }
  }

  .card-hint {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  font-style: italic;
  color: #474747;
  text-align: center;
}
</style>
</head>
<body>
  <h1 id="flashTitle"><a id="flashLink" href="#" target="_blank">Quizlet-Style Flashcards</a></h1>
  <div id="qCount">Loading...</div>
  <div class="flashcard-container">
    <div class="flashcard" onclick="flipCard(event)">
      <div class="card" id="card">
        <div class="side front" id="question">Loading...</div>
        <div class="side back" id="answer">Loading...</div>
      </div>
      <div class="card-hint">Click card to reveal answer</div>
    </div>
    <div class="options" id="options"></div>
  </div>
  
  

  <div class="controls-row">
    <button class="bookmark-btn" id="bookmarkBtn" onclick="toggleBookmark()" title="Bookmark">&#9734;</button>
    <button onclick="prevCard()">< Prev</button>
    <button onclick="nextCard()">Next ></button>
    <button onclick="submitAnswer()" id="submitBtn">Submit</button>
    <button onclick="showMissedQuestions()">Missed</button>
    <button onclick="toggleShowBookmarked()" id="showBookmarkedBtn">Bookmarked</button>
  </div>

  <div id="feedback"></div>

<script>
let cards = [];
let current = 0;
let selected = null;
let answered = false;
let missedQuestions = [];

let bookmarks = JSON.parse(localStorage.getItem('bookmarkedQuestions') || "[]");
let showOnlyBookmarked = false;
let bookmarkedOrder = [];

// Load flashcards from localStorage
(function initFromLocalStorage() {
  try {
    const raw = localStorage.getItem("flashcard_data");
    if (!raw) {
      document.getElementById("question").innerText = "No flashcards found.";
      document.getElementById("answer").innerText = "";
      document.getElementById("qCount").innerText = "No questions";
      return;
    }
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed) || parsed.length === 0) {
      document.getElementById("question").innerText = "No flashcards found.";
      document.getElementById("answer").innerText = "";
      document.getElementById("qCount").innerText = "No questions";
      return;
    }
    cards = parsed;
    updateBookmarkedOrder();
    const arr = showOnlyBookmarked ? bookmarkedOrder : Array.from({ length: cards.length }, (_, i) => i);
    current = arr.length > 0 ? arr[0] : 0;
    showCard(current);
  } catch (e) {
    document.getElementById("question").innerText = "Failed to load flashcards.";
    document.getElementById("answer").innerText = "";
    document.getElementById("qCount").innerText = "No questions";
    console.error(e);
  }
})();

function showCard(index) {
  document.getElementById('card').classList.remove('flipped');
  document.getElementById('question').innerText = cards[index].q;
  document.getElementById('answer').innerText = cards[index].a;
  selected = null;
  answered = false;
  document.getElementById('feedback').innerText = '';
  document.getElementById('submitBtn').disabled = false;
  showOptions(index);
  updateBookmarkStar();
  updateCountDisplay();
}

function flipCard(e) {
  if (e.target.classList.contains("option") || e.target.classList.contains("bookmark-btn")) return;
  document.getElementById('card').classList.toggle('flipped');
}

function nextCard() {
  const arr = showOnlyBookmarked ? bookmarkedOrder : Array.from({ length: cards.length }, (_, i) => i);
  if (arr.length === 0) return;
  let idx = arr.indexOf(current);
  idx = (idx + 1) % arr.length;
  current = arr[idx];
  showCard(current);
}

function prevCard() {
  const arr = showOnlyBookmarked ? bookmarkedOrder : Array.from({ length: cards.length }, (_, i) => i);
  if (arr.length === 0) return;
  let idx = arr.indexOf(current);
  idx = (idx - 1 + arr.length) % arr.length;
  current = arr[idx];
  showCard(current);
}

function showOptions(index) {
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  const correct = cards[index].a;
  let wrongs = cards.filter((c, i) => i !== index).map(c => c.a);
  wrongs = wrongs.sort(() => 0.5 - Math.random()).slice(0, 2);
  const answers = [correct, ...wrongs].sort(() => 0.5 - Math.random());
  answers.forEach(ans => {
    const div = document.createElement('div');
    div.className = 'option';
    div.innerText = ans;
    div.onclick = () => selectOption(div, ans, correct);
    optionsDiv.appendChild(div);
  });
}

function selectOption(div, ans, correct) {
  if (answered) return;
  const opts = document.querySelectorAll('.option');
  opts.forEach(o => o.classList.remove('selected'));
  div.classList.add('selected');
  selected = ans;
}

function submitAnswer() {
  if (answered || selected === null) return;
  answered = true;
  const correct = cards[current].a.trim();
  const opts = document.querySelectorAll('.option');
  opts.forEach(o => {
    const optText = o.innerText.trim();
    if (optText === correct) o.classList.add('correct');
    else o.classList.add('wrong');
    o.onclick = null;
  });
  if (selected === correct) {
    document.getElementById('feedback').innerText = 'Correct!';
  } else {
    document.getElementById('feedback').innerText = 'Incorrect.';
    // âœ… Prevent duplicate entries
    if (!missedQuestions.some(q => q.q === cards[current].q && q.a === cards[current].a)) {
      missedQuestions.push(cards[current]);
    }
  }
  document.getElementById('submitBtn').disabled = true;
}

function updateBookmarkStar() {
  const btn = document.getElementById('bookmarkBtn');
  if (bookmarks.includes(current)) {
    btn.innerHTML = '&#9733;';
    btn.classList.add('bookmarked');
  } else {
    btn.innerHTML = '&#9734;';
    btn.classList.remove('bookmarked');
  }
}

function toggleBookmark() {
  const idx = bookmarks.indexOf(current);
  if (idx === -1) bookmarks.push(current);
  else bookmarks.splice(idx, 1);
  localStorage.setItem('bookmarkedQuestions', JSON.stringify(bookmarks));
  updateBookmarkStar();
  updateBookmarkedOrder();
}

function updateBookmarkedOrder() {
  bookmarkedOrder = bookmarks.slice();
  if (showOnlyBookmarked && !bookmarkedOrder.includes(current)) {
    if (bookmarkedOrder.length > 0) {
      current = bookmarkedOrder[0];
      showCard(current);
    } else {
      document.getElementById('question').innerText = 'No bookmarked cards.';
      document.getElementById('answer').innerText = '';
      document.getElementById('options').innerHTML = '';
      document.getElementById('feedback').innerText = '';
      updateCountDisplay();
    }
  }
}

function toggleShowBookmarked() {
  showOnlyBookmarked = !showOnlyBookmarked;
  document.getElementById('showBookmarkedBtn').classList.toggle('show-bookmarked', showOnlyBookmarked);
  updateBookmarkedOrder();
  const arr = showOnlyBookmarked ? bookmarkedOrder : Array.from({ length: cards.length }, (_, i) => i);
  if (arr.length > 0) {
    current = arr[0];
    showCard(current);
  } else {
    document.getElementById('question').innerText = 'No bookmarked cards.';
    document.getElementById('answer').innerText = '';
    document.getElementById('options').innerHTML = '';
    document.getElementById('feedback').innerText = '';
    updateCountDisplay();
  }
}

function updateCountDisplay() {
  const arr = showOnlyBookmarked ? bookmarkedOrder : Array.from({ length: cards.length }, (_, i) => i);
  const countElem = document.getElementById('qCount');
  if (arr.length === 0) {
    countElem.innerText = 'No questions';
  } else {
    const position = arr.indexOf(current) + 1;
    countElem.innerText = "Question " + position + " of " + arr.length;
  }
}

function showMissedQuestions() {
  const existing = document.getElementById("missedContainer");
  if (existing) existing.remove();
  const missedDiv = document.createElement("div");
  missedDiv.id = "missedContainer";
  missedDiv.innerHTML = '<h2>Missed Questions:</h2>';
  if (missedQuestions.length === 0) {
    missedDiv.innerHTML += '<p>None! Great job!</p>';
  } else {
    missedQuestions.forEach((q, i) => {
      missedDiv.innerHTML += `<p><strong>Q${i+1}:</strong> ${q.q}<br><strong>A:</strong> ${q.a}</p>`;
    });
  }
  document.body.appendChild(missedDiv);
}

// Set header link and title
const sourceUrl = localStorage.getItem("flashcard_source_url") || "#";
const topicTitle = localStorage.getItem("flashcard_topic_title") || "Quizlet-Style Flashcards";
const linkElem = document.getElementById("flashLink");
linkElem.href = sourceUrl;
linkElem.textContent = topicTitle;
</script>
</body>
</html>
